$(function(){function m(a){"open"==a?($("#loader").show(),$("#myDiv").hide()):($("#loader").hide(),$("#myDiv").show())}function u(){for(var a=Math.round,b=Math.random,h=a(255*b()),c=a(255*b()),d=a(255*b());240>h+c+d||400<h+c+d;)h=a(255*b()),c=a(255*b()),d=a(255*b());console.log(h+c+d);return"rgba("+h+","+c+","+d+", 0.2)"}function t(){m("open");var a={};a.de=$("#de").val();a.ate=$("#ate").val();a.freq=$("#frequencia").val();$.ajax({url:"/graph",data:a,type:"POST",dataType:"json",success:function(b){var a=
document.getElementById("canvas").getContext("2d"),c=[],d=0,g=0,p=[],f="";$.each(b.rp.labels,function(b,a){c.push(a[0])});var q=[];$.each(b.rp.locais,function(b,a){p=[];d=0;f="";$.each(a,function(b,a){g=c.indexOf(a[1]);if(-1<g)d==g&&(p.push(a[0]),d++);else for(;d<=g;d++)p.push(0)});f=u();q.push({label:b,data:p,backgroundColor:[f],borderColor:[f.replace("0.2","1")],borderWidth:1})});window.myLineChart=new Chart(a,{type:"line",data:{labels:c,datasets:q},options:{elements:{line:{tension:.2}}}});m("close")},
error:function(a){console.log(a)}})}function r(){$.ajax({url:"/cad",data:{acao:"lista"},type:"POST",dataType:"json",success:function(a){var b="",h="",c="";$.each(a.rp,function(a,g){g[3]?(b="table-success",h="Ativo"):(b="table-danger",h="Inativo");c+="<tr stt="+h+' class="'+b+'">';$.each(g,function(a,b){c=3!=a?c+("<td>"+b+"</td>"):c+("<td>"+h+"</td>")});c+="</tr>"});$("#tbodyCad").html(c);m("close")},error:function(a){console.log(a)}})}$("#buscarTb").on("click",function(a){a.preventDefault();m("open");
a={};a.mes=$("#mes").val();a.ano=$("#ano").val();$.ajax({url:"/tbData",data:a,type:"POST",dataType:"json",success:function(a){var b="",c="",d='<i class="fas fa-minus"></i>',g=0,p=0,f=0,q=0,k=0,l=0,n=0;$("#tbodyDetalhes").html("");$.each(a.tabela,function(h,e){p+=e[2];g=parseFloat(e[3]/a.total*100).toFixed(2);isNaN(g)&&(g=0);null!=e[2]&&0!=e[2]||1==e[2];null==e[3]&&(e[3]=0);l=e[2]-e[3];n=e[3];0==n&&(n=1);f=parseFloat(l/n*100).toFixed(2);0<f?(d='<i class="fas fa-sort-up text-danger"></i>',c='class="text-danger"'):
0>f&&(d='<i class="fas fa-sort-down text-success"></i>',c='class="text-success"');q=(110*e[3]/1E3).toFixed(2);k=(220*e[3]/1E3).toFixed(2);b+="<tr>";b+="<td>"+e[0]+"</td>\t\t\t\t\t\t\t\t<td>"+e[1]+"</td>\t\t\t\t\t\t\t\t<td>"+e[3]+" A</td>\t\t\t\t\t\t\t\t<td>"+q+" Kw</td>\t\t\t\t\t\t\t\t<td>"+k+" Kw</td>\t\t\t\t\t\t\t\t<td "+c+">"+f+"% "+d+"</td>\t\t\t\t\t\t\t\t<td>"+g+"%</td>";b+="</tr>"});null==a.total&&(a.total=0);q=(110*a.total/1E3).toFixed(2);k=(220*a.total/1E3).toFixed(2);l=p-a.total;n=a.total;
0==n&&(n=1);f=parseFloat(l/n*100).toFixed(2);0<f?(d='<i class="fas fa-sort-up text-danger"></i>',c='class="text-danger"'):0>f&&(d='<i class="fas fa-sort-down text-success"></i>',c='class="text-success"');$("#tbodyDetalhes").html('<tr class="table-info">\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\t<i class="fas fa-globe"></i>\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\tTotal\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\t'+a.total+" A\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\t"+
q+" Kw\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\t"+k+" Kw\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td "+c+">\t\t\t\t\t\t\t\t\t\t\t\t"+f+" % "+d+"</i>\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t<td>\t\t\t\t\t\t\t\t\t\t\t\t100%\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t</tr>");$("#tbodyDetalhes").append(b);m("close")},error:function(a){console.log(a)}})});$(document).on("click","#buscarGraph",function(){myLineChart.destroy();t()});$(document).on("click",
"#tbodyCad tr",function(){$("#tbodyCad tr.table-info").removeClass("table-info");$(this).addClass("table-info");$("#idLocal").val($(this).find("td:eq(0)").html());$("#local").val($(this).find("td:eq(2)").html());M.updateTextFields()});$(document).on("click","#salvar",function(){if(""!=$("#idLocal").val()){m("open");var a={acao:"salvar"};a.id=$("#idLocal").val();a.local=$("#local").val();$.ajax({url:"/cad",data:a,type:"POST",dataType:"json",success:function(a){0<a.rp?M.toast({html:"<span>Atualizado com sucesso!</span>",
classes:"bg-success"}):M.toast({html:"<span>Nenhum local encontrado!</span>",classes:"bg-info"});r();m("close")},error:function(a){console.log(a)}})}else M.toast({html:"<span>Nenhum local selecionado!</span>",classes:"bg-danger"})});$(document).on("click","#io",function(){if(""!=$("#idLocal").val()){m("open");var a={acao:"io"};a.status=$("#tbodyCad tr.table-info").attr("stt");a.id=$("#idLocal").val();$.ajax({url:"/cad",data:a,type:"POST",dataType:"json",success:function(a){0<a.rp?M.toast({html:"<span>Local alterado com sucesso!</span>",
classes:"bg-success"}):M.toast({html:"<span>Nenhum local encontrado!</span>",classes:"bg-info"});r();m("close")},error:function(a){console.log(a)}})}else M.toast({html:"<span>Nenhum local selecionado!</span>",classes:"bg-danger"})});$("#buscarTb").trigger("click");$(".calendario").mask("00/00/0000");var k=new Date,l=k.getMonth()+1;10>l&&(l="0"+l);k=k.getFullYear();$("#de").val("01/"+l+"/"+k);$("#ate").val((new Date(k,l,0)).getDate()+"/"+l+"/"+k);$(".calendario").datepicker({dateFormat:"dd/mm/yy",
dayNames:"Domingo Segunda Ter\u00e7a Quarta Quinta Sexta S\u00e1bado".split(" "),dayNamesMin:"DSTQQSSD".split(""),dayNamesShort:"Dom Seg Ter Qua Qui Sex S\u00e1b Dom".split(" "),monthNames:"Janeiro Fevereiro Mar\u00e7o Abril Maio Junho Julho Agosto Setembro Outubro Novembro Dezembro".split(" "),monthNamesShort:"Jan Fev Mar Abr Mai Jun Jul Ago Set Out Nov Dez".split(" "),nextText:"Pr\u00f3ximo",prevText:"Anterior"});t();r()});